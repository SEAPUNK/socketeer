define("SocketeerBrowserClient",[],function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(t.s=11)}([function(e,t,n){(function(e,r){function i(e,t){this._id=e,this._clearFn=t}var s=n(19).nextTick,o=Function.prototype.apply,a=Array.prototype.slice,u={},c=0;t.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,r=arguments.length<2?!1:a.call(arguments,1);return u[n]=!0,s(function(){u[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete u[e]}}).call(t,n(0).setImmediate,n(0).clearImmediate)},function(e,t){"use strict";t.ActionResponse={OK:0,NONEXISTENT:1,ERROR:2},t.PROTOCOL_VERSION=2},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:h(i,t,n)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(n)},u=n(12),c=n(13),l=function(e){function t(e,n,s,o){r(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a._WebSocket=s,a._isBrowserClient=o,n||(n={}),a._wsConstructArgs=[e,n.protocols,n.ws],a._heartbeatTimeout=n.heartbeatTimeout||15e3,a._handshakeTimeout=n.handshakeTimeout||1e4,a._reconnectWait=n.reconnectWait||5e3,a._failless=n.failless!==!1,a._isReady=!1,a._isReconnection=!1,a._resumePromiseResolve=null,a._resumeToken=null,a._heartbeatTimer=null,a._willReconnect=!1,a.ws={readyState:s.CLOSED,CLOSED:s.CLOSED},a._failless&&a.on("error",function(e){}),a._prepareConnection(),a}return s(t,e),o(t,[{key:"_prepareConnection",value:function(){var e=this,t=this._wsConstructArgs,n=this._handshakeTimeout,r=this._resumePromiseResolve?this._resumeToken:null,i=new c(t,n,r,this._WebSocket,this._isBrowserClient);i.openHandler=function(){e._emit("unreadyOpen",e._isReconnection)},i.promise.then(function(t){var n=t.ws,r=t.heartbeatInterval,i=t.isResume,s=t.resumeOk,o=t.resumeToken;return e._resumeToken=o,e._heartbeatInterval=r,i&&!s?e._resolveSessionResume(!1):(e.ws=n,e._socketeerClosing=!1,e._attachEvents(),void e._finalizePreparation(i))})["catch"](function(t){return r?e._resolveSessionResume(!1):(e._emit("error",t,!0),void e._emit("close",null,null,t))})}},{key:"_finalizePreparation",value:function(e){e||this._clearMessageQueue(),this._isReady=!0,this._resetHeartbeatTimeout(),this._resumeMessageQueue(),e||this._emit("open",this._isReconnection),e&&this._resolveSessionResume(!0)}},{key:"_handleClose",value:function(e){this._isReady=!1,this._stopHeartbeatTimeout(),a(Object.getPrototypeOf(t.prototype),"_handleClose",this).call(this,e)}},{key:"_handleMessage",value:function(e){var n=e.data;if("h"===n){if(!this.isOpen())return;return void this._handleHeartbeat()}a(Object.getPrototypeOf(t.prototype),"_handleMessage",this).call(this,e)}},{key:"_resolveSessionResume",value:function(e){var t=this._resumePromiseResolve;this._resumePromiseResolve=null,t(e)}},{key:"_handleHeartbeat",value:function(){this._resetHeartbeatTimeout(),this.ws.send("h"),this._emit("ping")}},{key:"_resetHeartbeatTimeout",value:function(){var e=this,t=this._heartbeatInterval+this._heartbeatTimeout;this._stopHeartbeatTimeout(),this._heartbeatTimer=setTimeout(function(){e._isReady&&(e._emit("timeout"),e.close(3e3,"heartbeat timeout"))},t)}},{key:"_stopHeartbeatTimeout",value:function(){this._heartbeatTimer&&clearTimeout(this._heartbeatTimer)}},{key:"resume",value:function(){var e=this;return new Promise(function(t,n){return e.isClosing()||e.isClosed()?e._resumeToken?(e._resumePromiseResolve=t,void e._doReconnect()):t(!1):n(new Error("client has not disconnected to resume session yet"))})}},{key:"reconnect",value:function(e){var t=this;if(!this.isClosing()&&!this.isClosed())throw new Error("client has not disconnected to reconnect yet");if(!this._willReconnect){this._willReconnect=!0,this._resumeToken=null;var n=e?0:this._reconnectWait;setTimeout(function(){t._doReconnect()},n)}}},{key:"_doReconnect",value:function(){this._willReconnect=!1,this._isReconnection=!0,this._prepareConnection()}}]),t}(u);e.exports=l},function(e,t,n){"use strict";var r=n(9);e.exports=function(e,t){return r(function(t,n){e(t[0],n)},t,1)}},function(e,t){"use strict";e.exports=function(e,t){for(var n=-1,r=e.length;++n<r;)t(e[n],n,e)}},function(e,t){"use strict";e.exports=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t){"use strict";e.exports=function(e,t){for(var n=-1,r=e.length,i=new Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},function(e,t){"use strict";e.exports=function(){}},function(e,t){"use strict";e.exports=function(e){return function(){if(null===e)throw new Error("Callback was already called.");e.apply(this,arguments),e=null}}},function(e,t,n){"use strict";var r=n(6),i=n(7),s=n(5),o=n(8),a=n(4),u=n(10);e.exports=function(e,t,n){function c(e,t,n,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");return e.started=!0,s(t)||(t=[t]),0===t.length&&e.idle()?u(function(){e.drain()}):(a(t,function(t){var s={data:t,callback:r||i};n?e.tasks.unshift(s):e.tasks.push(s),e.tasks.length===e.concurrency&&e.saturated()}),void u(e.process))}function l(e,t){return function(){h-=1;var n=!1,r=arguments;a(t,function(e){a(f,function(t,r){t!==e||n||(f.splice(r,1),n=!0)}),e.callback.apply(e,r)}),e.tasks.length+h===0&&e.drain(),e.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var h=0,f=[],p={tasks:[],concurrency:t,payload:n,saturated:i,empty:i,drain:i,started:!1,paused:!1,push:function(e,t){c(p,e,!1,t)},kill:function(){p.drain=i,p.tasks=[]},unshift:function(e,t){c(p,e,!0,t)},process:function(){for(;!p.paused&&h<p.concurrency&&p.tasks.length;){var t=p.payload?p.tasks.splice(0,p.payload):p.tasks.splice(0,p.tasks.length),n=r(t,function(e){return e.data});0===p.tasks.length&&p.empty(),h+=1,f.push(t[0]);var i=o(l(p,t));e(n,i)}},length:function(){return p.tasks.length},running:function(){return h},workersList:function(){return f},idle:function(){return p.tasks.length+h===0},pause:function(){p.paused=!0},resume:function(){if(p.paused!==!1){p.paused=!1;for(var e=Math.min(p.concurrency,p.tasks.length),t=1;e>=t;t++)u(p.process)}}};return p}},function(e,t,n){(function(t){"use strict";var n="function"==typeof t&&t,r=function(e){setTimeout(e,0)};e.exports=function(e){return(n||r)(e)}}).call(t,n(0).setImmediate)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(2),a=function(e){function t(e,n){return r(this,t),i(this,Object.getPrototypeOf(t).call(this,e,n,window.WebSocket,!0))}return s(t,e),t}(o);e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function _(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:_(i,t,n)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(n)},u=n(17).EventEmitter,c=n(18),l=n(16),h=n(20),f=n(14),p=n(1),v=p.ActionResponse,d=p.PROTOCOL_VERSION,m=function(e){function t(){r(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e._emit=a(Object.getPrototypeOf(t.prototype),"emit",e).bind(e),e.PROTOCOL_VERSION=d,e._sEvents=new Map,e._actions=new Map,e._actionPromises=new Map,e._currentActionId=0,e._messageQueue=new f(function(t,n){return e._processQueue(t,n)}),e._messageQueue.pause(),e._closeMustHaveError=!1,e._socketeerClosing=!1,e.data={},e}return s(t,e),o(t,[{key:"_attachEvents",value:function(){var e=this;this.ws.onmessage=function(t){return e._handleMessage(t)},this.ws.onerror=function(t){return e._handleError(t)},this.ws.onclose=function(t){return e._handleClose(t)}}},{key:"_detachEvents",value:function(){this.ws.onmessage=function(){},this.ws.onclose=function(){},this.ws.onerror=function(e){}}},{key:"emit",value:function(e,t){this.send({e:e,d:t})}},{key:"_handleMessage",value:function(e){var t=e.data,n=e.binary||!("string"==typeof t||"number"==typeof t);if(!n&&"string"==typeof t){var r=void 0;try{r=JSON.parse(t)}catch(i){return}l(r,"a")?this._handleAction(r):l(r,"s")?this._handleActionResponse(r):l(r,"e")&&this._handleEvent(r)}}},{key:"close",value:function(e,t){this.ws.close(e,t)}},{key:"terminate",value:function(){this.ws.terminate()}},{key:"_handleError",value:function(e){this._socketeerClosing||(this._emit("error",e,!0),this._closeMustHaveError=!0,this.close(),e||(e=new Error("unknown, unspecified error")),this._handleClose({code:null,reason:null,error:e}))}},{key:"_handleClose",value:function(e){if(!this._socketeerClosing){e||(e={});var t=e.error,n=e.code,r=e.reason;if(t||(t=null),t||!this._closeMustHaveError){this._socketeerClosing=!0,this._closeMustHaveError=!1,this._detachEvents();var i=this._closeIsPause?"pause":"close";this._emit(i,n,r,t)}}}},{key:"_processQueue",value:function(e,t){return this.isOpen()?this.ws.send(e,t):(this._messageQueue.pause(),this._messageQueue.unshift(e),h(t))}},{key:"_resumeMessageQueue",value:function(){this._messageQueue.resume()}},{key:"_clearMessageQueue",value:function(){this._messageQueue.kill()}},{key:"send",value:function(e){var t=void 0;try{t=JSON.stringify(e)}catch(n){}this._messageQueue.push(t)}},{key:"_handleAction",value:function(e){var t=this,n=this._actions.get(e.a);if(!n)return this.send({i:e.i,s:v.NONEXISTENT,d:v.NONEXISTENT});var r=void 0;try{r=n(e.d)}catch(i){return this.send({i:e.i,s:v.ERROR,d:v.ERROR}),this._emit("error",new Error("action handler for "+e.a+" call errored: "+c(i)))}return r&&"function"==typeof r.then&&"function"==typeof r["catch"]?void r.then(function(n){t.send({i:e.i,s:v.OK,d:n})})["catch"](function(n){t.send({i:e.i,s:v.ERROR,d:v.ERROR}),t._emit("error",new Error("action handler for "+e.a+" catch errored: "+c(n)))}):(this.send({i:e.i,s:v.ERROR,d:v.ERROR}),this._emit("error",new Error("action handler for "+e.a+" does not return a promise")))}},{key:"_handleActionResponse",value:function(e){var t=this._actionPromises.get(e.i);if(t){t.finished=!0,t.timeout&&clearTimeout(t.timeout);var n=void 0;switch(e.s){case v.OK:break;case v.ERROR:n=new Error("an error occured processing action");break;case v.NONEXISTENT:n=new Error("action does not exist");break;default:n=new Error("an unknown non-OK response was received: "+e.s)}try{n?t.reject(n):t.resolve(e.d)}catch(n){this._emit("error",new Error("could not resolve or reject the action response handler: "+n))}this._actionPromises["delete"](e.i)}}},{key:"_handleEvent",value:function(e){var t=this._sEvents.get(e.e);if(t&&t.length){var n=!0,r=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;try{a(e.d)}catch(u){this._emit("error",u);continue}}}catch(u){r=!0,i=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}}},{key:"event",value:function(e,t){if("function"!=typeof t)throw new Error("event handler is not a function");this._sEvents.get(e)||this._sEvents.set(e,[]),this._sEvents.get(e).push(t)}},{key:"action",value:function(e,t,n){if("function"!=typeof t)throw new Error("action handler is not a function");if(this._actions.get(e)&&!n)throw new Error('action handler is already set (use the "force" flag to override)');this._actions.set(e,t)}},{key:"request",value:function(e,t,n){var r=this;return new Promise(function(i,s){n||(n={}),void 0===n.timeout&&(n.timeout=3e4);var o=r._generateActionId(),a={resolve:i,reject:s,finished:!1};n.timeout&&(a.timeout=setTimeout(function(){a.finished||(r._actionPromises["delete"](o),a.reject(new Error("Action timed out")))},n.timeout)),r._actionPromises.set(o,a),r.send({i:o,a:e,d:t})})}},{key:"_generateActionId",value:function(){return this._currentActionId++}},{key:"isOpening",value:function(){return this.ws.readyState===this.ws.CONNECTING}},{key:"isOpen",value:function(){return this.ws.readyState===this.ws.OPEN}},{key:"isClosing",value:function(){return this.ws.readyState===this.ws.CLOSING}},{key:"isClosed",value:function(){return this.ws.readyState===this.ws.CLOSED}}]),t}(u);e.exports=m},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){return n?new e(t[0],t[1]):new e(t[0],t[1],t[2])}function s(){}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(15).validateSessionResumeToken,u=n(1).PROTOCOL_VERSION,c=function(){function e(t,n,i,o,a){var u=this;r(this,e),this.wsArgs=t,this.handshakeTimeout=n,this.resumeToken=i,this._WebSocket=o,this.isBrowser=a,this.prepared=!1,this.promise=new Promise(function(e,t){u.resolve=e,u.reject=t}),this.openHandler=s,this.handshakeStep=0,this.returnValue={ws:null,heartbeatInterval:null,isResume:!!i,resumeOk:!1,resumeToken:null},this.createSocket()}return o(e,[{key:"createSocket",value:function(){var e=this;this.ws=this.returnValue.ws=i(this._WebSocket,this.wsArgs,this.isBrowser),this.ws.onopen=function(){return e.handleOpen()},this.ws.onmessage=function(t){return e.handleMessage(t)},this.ws.onerror=function(t){return e.handleError(t)},this.ws.onclose=function(t){return e.handleClose(t)}}},{key:"handleOpen",value:function(){this.openHandler(),this.startHandshakeTimeout()}},{key:"handleError",value:function(e){this.prepared||(this.prepared=!0,this.ws.close(),this.reject(e))}},{key:"handleClose",value:function(){this.prepared||(this.prepared=!0,this.ws.close(),this.reject(new Error("Socket closed before handshake could complete.")))}},{key:"handleMessage",value:function(e){if(!this.prepared){var t=e.data;switch(this.handshakeStep){case 0:return this.handshakeStep=1,this.handleServerHandshake(t);case 1:return this.handshakeStep=2,this.handleHandshakeResponse(t);case 2:return this.handleError(new Error("Server sent an unexpected handshake message."));default:return this.handleError(new Error("[INTERNAL ERROR] Unknown handshake step: "+this.handshakeStep))}}}},{key:"handleServerHandshake",value:function(e){var t=this;if("string"!=typeof e)return this.handleError(new Error("Handshake data is not a string."));var n=e.split(":");if("socketeer"!==n[0])return this.handleError(new Error("Server is not a Socketeer server."));if("string"!=typeof n[1]||0!==n[1].indexOf("v"))return this.handleError(new Error("Server protcol version is not specified."));var r=Math.floor(+n[1].replace(/^v/,""));if(Number.isNaN(n[1])||n[1]<=0)return this.handleError(new Error("Server protocol version is invalid."));if(r!==u)return this.ws.send("v"+u,function(e){var n="Server protcol is incompatible with the client.";return e?t.handleError(new Error(n+" (failed telling the server our version)")):t.handleError(new Error(n))});if("string"!=typeof n[2]||0!==n[2].indexOf("i"))return this.handleError(new Error("Heartbeat interval set message not provided."));var i=Math.floor(+n[2].replace(/^i/,""));return Number.isNaN(n[2])||n[2]<0||n[2]>2147483647?this.handleError(new Error("Server's heartbeat interval is invalid.")):(this.returnValue.heartbeatInterval=i,void(this.resumeToken?this.ws.send("r@"+this.resumeToken):this.ws.send("r?")))}},{key:"handleHandshakeResponse",value:function(e){if("string"!=typeof e)return this.handleError(new Error("Handshake response is not a string."));var t=e.split(":");return"ok"!==t[0]?"err"===t[0]?this.handleError(new Error("Server encountered an error during handshake.")):this.handleError(new Error("Server sent an unexpected handshake response status.")):void(this.resumeToken?this.handlePotentialSessionResume(t):this.handleSetSessionResume(t))}},{key:"handlePotentialSessionResume",value:function(e){if("-"===e[1])return this.returnValue.resumeOk=!1,this.finishPreparation();if("+"===e[1]){var t=e[2];return a(t)?(this.returnValue.resumeOk=!0,this.returnValue.resumeToken=t,this.finishPreparation()):this.handleError(new Error("Invalid new session resume token."))}return this.handleError(new Error("Invalid session resume status."))}},{key:"handleSetSessionResume",value:function(e){if("y"===e[1]){var t=e[2];return a(t)?(this.returnValue.resumeToken=t,this.finishPreparation()):this.handleError(new Error("Invalid new session resume token."))}return"n"===e[1]?this.finishPreparation():this.handleError(new Error("Invalid session resume support status."))}},{key:"finishPreparation",value:function(){this.prepared=!0,this.returnValue.isResume&&!this.returnValue.resumeOk&&this.ws.close(),this.resolve(this.returnValue)}},{key:"startHandshakeTimeout",value:function(){var e=this;setTimeout(function(){e.prepared||(e.prepared=!0,e.ws.close(),e.reject(new Error("Handshake timed out.")))},this.handshakeTimeout)}}]),e}();e.exports=c},function(e,t,n){"use strict";e.exports=n(3)},function(e,t){"use strict";t.validateSessionResumeToken=function(e){return!("string"!=typeof e||e.length<5||e.length>200||-1!==e.indexOf(":"))}},function(e,t){e.exports=function(e,t){if(t&&(t=t.split(".")),null===e||void 0===e)return!1;if(!t)return!0;for(var n,r=e,i=0;i<t.length;i++){if(n=t[i],null===r[n]||void 0===r[n])return!1;r=r[n]}return!0}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(s(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),i=c.length,u=0;i>u;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){e.exports=function(e){return e&&e.stack?e.stack:e}},function(e,t){function n(){c=!1,o.length?u=o.concat(u):l=-1,u.length&&r()}function r(){if(!c){var e=setTimeout(n);c=!0;for(var t=u.length;t;){for(o=u,u=[];++l<t;)o&&o[l].run();l=-1,t=u.length}o=null,c=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function s(){}var o,a=e.exports={},u=[],c=!1,l=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new i(e,t)),1!==u.length||c||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){(function(t){"use strict";e.exports="function"==typeof t?t:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}}).call(t,n(0).setImmediate)}])});